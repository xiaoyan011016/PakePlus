import{f as P}from"./style-BA2H1GC3.js";import{u as U,d as Y,s as $}from"./dataview-q4Jj-tHZ.js";import{d as A,s as x,i as C,r as B,j as m,a1 as I,o as X,k as Z,O as K,c as q,h as F,g as G,e as d,w as r,q as i,Q as E,S as J,f as D,a as k,a0 as Q,p as c,W as ee}from"./index-BGwiQ_ZP.js";import{l as te}from"./lodash-buJ1Dk2D.js";import{u as oe}from"./dataviewLayout-BV-xrtOb.js";import ae from"./edit-tool-TwvXkOAo.js";import{u as ne}from"./useDrag-rnSsin84.js";import{E as se}from"./dataviewTypes-DjJw5iW5.js";import{c as re}from"./index-hBluw3-o.js";import{B as ie}from"./index-_DVN_kvK.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./project-BHkV2mwb.js";import"./index-CV9vVqBq.js";import"./index-D6J3dazT.js";import"./image-404-CYQSRSGu.js";import"./config-C6dLhLlW.js";import"./index-BJkTEgjb.js";import"./index-DzzgRnZQ.js";import"./_getTag-BRywsnft.js";import"./zoom-CXqzwkKe.js";import"./vnode-BaoCyZaz.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./useState-DblkWJ1i.js";import"./devWarning-MTSIIkhh.js";import"./compact-item-CDNQQAbH.js";const ue={ref:"$app",class:"edit-screens"},de={class:"menu-list"},ce=A({__name:"index",setup(pe){const{mousedownHandleUnStop:g}=ne(),L=oe(),{dataviewLayoutState:l}=x(L),s=U(),{dataviewState:u}=x(s),p=C(),z=C(),h=C(),w=C(),o=B({thick:20,startX:0,startY:0,lines:{h:[],v:[]},isShowReferLine:!0,rendIndex:0,lockLine:!1,showRuler:!0,isBlack:!1,snapsObj:{h:[0,100,200],v:[130]},sketchRuleReDraw:!0,canvasWidth:1920,canvasHeigth:1080,autoCenter:!0,isShow:!0}),y=m({get(){return u.value.editCanvas.scale},set(e){u.value.editCanvas.scale=e}}),_=B({maxScale:3,minScale:.3,startX:0,startY:0,disablePan:!1,disableZoom:!1,contain:"none",handleStartEvent:e=>{e.preventDefault(),console.log("handleStartEvent",e)}}),M=m(()=>({width:`${v().width}px`,height:`${v().height}px`})),O=m(()=>o.isBlack?{bgColor:"transparent",hoverBg:"#fff",hoverColor:"#000",longfgColor:"#BABBBC",fontColor:"#DEDEDE",shadowColor:"#525252",lineColor:"#51d6a9",borderColor:"#B5B5B5"}:{bgColor:"transparent",lineColor:"#51d6a9",lineType:"dashed"}),f=m(()=>{if(l.value.layoutContentWidth){const e=Math.floor(l.value.layoutContentWidth*.9),t=Math.floor(e*9/16);return console.log("大小",e,t),{width:e,height:t}}return{width:1920,height:1080}}),v=()=>{if(l.value.layoutContentWidth&&l.value.layoutContentHeight){let e=0;return{width:l.value.layoutContentWidth-e,height:l.value.layoutContentHeight-e}}return{width:u.value.editCanvasConfig.width,height:u.value.editCanvasConfig.height}},T=()=>{o.isShowReferLine=!o.isShowReferLine},W=e=>{console.log("zoomchange",e,u.value),j()},j=()=>{u.value.componentList.forEach(e=>{e.attr=Object.assign(e.attr,{})})},V=()=>{p.value&&p.value.reset()},H=()=>{p.value&&p.value.zoomOut()},N=async e=>{var R;e.preventDefault();const t=(R=e.dataTransfer)==null?void 0:R.getData(ee.DRAG_KEY);if(!t)return;const n=JSON.parse(t);if(s.setEditCanvas(se.IS_CREATE,!1),n.disabled)return;const a=await Y(n);n.redirectComponent,$(a,e.offsetX-a.attr.w/2,e.offsetY-a.attr.h/2),s.addComponnetList(a,!1,!0),s.setTargetSelectChart(a.id)},S=e=>{e.preventDefault(),e.stopPropagation()},b=te.debounce(e=>{},200);return I(()=>l.value.layoutContentWidth,()=>{l.value.layoutContentWidth<50?o.isShow=!1:o.isShow=!0}),X(()=>{h.value&&(w.value=new ResizeObserver(e=>{for(const t of e){const{width:n,height:a}=t.contentRect;u.value.editCanvasConfig.width=n,u.value.editCanvasConfig.height=a}}),w.value.observe(h.value))}),Z(()=>{window.addEventListener("resize",b)}),K(()=>{var e;window.removeEventListener("resize",b),h.value&&((e=w.value)==null||e.unobserve(h.value))}),(e,t)=>{const n=ie;return o.isShow?(D(),q("div",{key:0,ref_key:"editRuleRef",ref:z,class:J(["edit-rule-container w-full h-full",[o.isBlack?"balckwrapper":"whitewrapper"]]),style:E(M.value)},[(D(),G(i(P),{ref_key:"sketchruleRef",ref:p,class:"sketch-rule-component",key:o.rendIndex,scale:y.value,"onUpdate:scale":t[1]||(t[1]=a=>y.value=a),"lock-line":o.lockLine,"onUpdate:lockLine":t[2]||(t[2]=a=>o.lockLine=a),thick:o.thick,width:v().width,height:v().height,"show-ruler":o.showRuler,palette:O.value,"snaps-obj":o.snapsObj,"canvas-width":f.value.width,"canvas-height":f.value.height,"panzoom-option":_,"is-show-refer-line":o.isShowReferLine,lines:o.lines,"auto-center":o.autoCenter,onOnCornerClick:T,onZoomchange:W},{default:r(()=>[k("div",ue,[d(re,null,{overlay:r(()=>[k("div",de,[d(n,{block:"",type:"text",onClickCapture:i(s).lockFun},{default:r(()=>t[3]||(t[3]=[c("锁定/解锁")])),_:1},8,["onClickCapture"]),d(n,{block:"",type:"text",onClickCapture:i(s).copy},{default:r(()=>t[4]||(t[4]=[c("复制")])),_:1},8,["onClickCapture"]),d(n,{block:"",type:"text",onClickCapture:i(s).cut},{default:r(()=>t[5]||(t[5]=[c("剪切")])),_:1},8,["onClickCapture"]),d(n,{block:"",type:"text",onClickCapture:i(s).paste},{default:r(()=>t[6]||(t[6]=[c("粘贴")])),_:1},8,["onClickCapture"]),d(n,{block:"",type:"text",onClickCapture:i(s).closeClipboard},{default:r(()=>t[7]||(t[7]=[c("清空剪切板")])),_:1},8,["onClickCapture"]),d(n,{block:"",type:"text",onClickCapture:i(s).deleteChart},{default:r(()=>t[8]||(t[8]=[c("删除")])),_:1},8,["onClickCapture"])])]),default:r(()=>[k("div",{ref_key:"refSketchRuleBox",ref:h,class:"canvas",id:"canvas",style:E({width:f.value.width+"px",height:f.value.height+"px"}),onMousedown:t[0]||(t[0]=(...a)=>i(g)&&i(g)(...a)),onDrop:N,onDragenter:S,onDragover:S},[Q(e.$slots,"default",{},void 0,!0)],36)]),_:3})],512)]),_:3},8,["scale","lock-line","thick","width","height","show-ruler","palette","snaps-obj","canvas-width","canvas-height","panzoom-option","is-show-refer-line","lines","auto-center"])),d(ae,{pState:o,onResetMethod:V,onZoomOutMethod:H},null,8,["pState"])],6)):F("",!0)}}}),He=le(ce,[["__scopeId","data-v-641aa446"]]);export{He as default};
